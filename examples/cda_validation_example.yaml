# CDA (Critical Data Attribute) Validation Example
# This demonstrates how to define and track Critical Data Attributes inline
# with each file configuration for intuitive CDA gap analysis.

validation_job:
  name: "Financial Data Validation with CDA Tracking"
  version: "1.0"
  description: "Example showing inline CDA gap analysis"

  # File configurations with inline CDAs
  files:
    - name: "customers"
      path: "examples/sample_data/customers.csv"
      format: "csv"
      delimiter: ","
      encoding: "utf-8"

      # Define Critical Data Attributes inline with the file
      # These are fields that require validation coverage for audit/compliance
      critical_data_attributes:
        - field: "customer_id"
          description: "Primary customer identifier"
          owner: "Data Team"

        - field: "email"
          description: "Customer contact email"
          owner: "Data Team"

        - field: "tax_id"
          description: "Tax identification number"
          owner: "Finance Team"

        - field: "account_balance"
          description: "Current account balance"
          owner: "Finance Team"

        - field: "credit_score"
          description: "Credit score for risk assessment"
          owner: "Credit Team"

        - field: "phone"
          description: "Customer contact number"
          owner: "Operations Team"

        - field: "registration_date"
          description: "Customer onboarding date"
          owner: "Operations Team"

      validations:
        # These validations cover CDAs: customer_id, email
        - type: "MandatoryFieldCheck"
          severity: "ERROR"
          params:
            fields: ["customer_id", "email", "first_name", "last_name"]

        # Covers CDA: email
        - type: "RegexCheck"
          severity: "ERROR"
          params:
            field: "email"
            pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"

        # Covers CDA: account_balance
        - type: "RangeCheck"
          severity: "WARNING"
          params:
            field: "account_balance"
            min_value: 0
            max_value: 10000000

        # Covers CDA: phone
        - type: "RegexCheck"
          severity: "WARNING"
          params:
            field: "phone"
            pattern: "^\\+?[1-9]\\d{1,14}$"

        # Covers CDA: registration_date
        - type: "DateFormatCheck"
          severity: "WARNING"
          params:
            field: "registration_date"
            format: "%Y-%m-%d"

        # NOTE: tax_id and credit_score are NOT validated
        # This will be flagged as a GAP in CDA analysis

    - name: "transactions"
      path: "examples/sample_data/transactions.csv"
      format: "csv"

      # CDAs for transactions file
      critical_data_attributes:
        - field: "transaction_id"
          description: "Unique transaction reference"
          owner: "Audit Team"

        - field: "amount"
          description: "Transaction value"
          owner: "Finance Team"

        - field: "transaction_date"
          description: "Transaction timestamp"
          owner: "Data Team"

      validations:
        # Covers CDAs: transaction_id, amount, transaction_date
        - type: "MandatoryFieldCheck"
          severity: "ERROR"
          params:
            fields: ["transaction_id", "customer_id", "amount", "transaction_date"]

        # Covers CDA: transaction_id
        - type: "UniqueKeyCheck"
          severity: "ERROR"
          params:
            fields: ["transaction_id"]

        # Covers CDA: amount
        - type: "RangeCheck"
          severity: "ERROR"
          params:
            field: "amount"
            min_value: 0.01
            max_value: 1000000

  output:
    html_report: "validation_report.html"
    json_summary: "validation_summary.json"
    fail_on_error: true

# ============================================================
# Running CDA Gap Analysis
# ============================================================
#
# To analyze CDA coverage and detect gaps:
#
#   python3 -m validation_framework.cli cda-analysis examples/cda_validation_example.yaml
#
# This will generate:
#   - Console output showing coverage summary
#   - HTML report (cda_gap_analysis.html) with detailed breakdown
#
# Expected output for this example:
#   - customers: 5/7 covered (71%)
#     - GAPS: tax_id, credit_score
#   - transactions: 3/3 covered (100%)
#
# Options:
#   --output FILE       Custom HTML output path
#   --json-output FILE  Generate JSON report for automation
#   --fail-on-gaps      Exit with error if any gaps (for CI/CD)
#
