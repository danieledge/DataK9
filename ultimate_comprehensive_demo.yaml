# ============================================================================
# DataK9 ULTIMATE Comprehensive Validation Demo
# ============================================================================
# Purpose: Showcase ALL 31 applicable validation types (34 total minus 3 SQL)
#
# Files Used:
#   • HI-Large_Trans.parquet: 179.7M rows, 5.1GB (High illicit activity)
#   • LI-Large_Trans.parquet: 177M rows, 5.0GB (Low illicit activity)
#   • HI-Large_Trans_baseline.parquet: 10M rows (Historical baseline for temporal drift)
#
# This demo includes 31 out of 34 validation types:
#   ✓ File-Level (3/3)
#   ✓ Schema (2/2)
#   ✓ Field-Level (5/5)
#   ✓ Record-Level (3/3)
#   ✓ Advanced (9/9)
#   ✓ Statistical (3/3)
#   ✓ Conditional (1/1)
#   ✓ Cross-File (3/3) - NEWLY ADDED
#   ✓ Temporal (2/2) - NEWLY ADDED
#   ✗ Database (0/3) - requires SQL database connection
#
# Performance Challenge:
#   • 357M total rows across files
#   • 10.1GB of Parquet data
#   • Full validation without sampling
#   • Tests framework limits and Polars optimization
# ============================================================================

validation_job:
  name: "DataK9 ULTIMATE Validation Showcase - All 31 Validation Types"
  description: "Demonstrates every non-SQL validation type on 357M rows, 10.1GB dataset"

  files:
    # ========================================================================
    # PRIMARY FILE: High Illicit Activity Transactions
    # ========================================================================
    - name: "HI_Transactions"
      path: "/home/daniel/www/test-data/HI-Large_Trans.parquet"
      format: "parquet"

      validations:
        # ====================================================================
        # FILE-LEVEL VALIDATIONS (3 types)
        # ====================================================================

        - type: "EmptyFileCheck"
          severity: "ERROR"
          # Ensures file contains data

        - type: "RowCountRangeCheck"
          severity: "WARNING"
          params:
            min_rows: 100000000
            max_rows: 200000000
          # Validates expected row count range (179M rows)

        - type: "FileSizeCheck"
          severity: "WARNING"
          params:
            min_size_bytes: 1000000000      # 1GB min
            max_size_bytes: 10000000000     # 10GB max
          # Validates file size (5.1GB expected)

        # ====================================================================
        # SCHEMA VALIDATIONS (2 types)
        # ====================================================================

        - type: "ColumnPresenceCheck"
          severity: "ERROR"
          params:
            required_columns:
              - "Timestamp"
              - "From Bank"
              - "Account"
              - "To Bank"
              - "Account.1"
              - "Amount Received"
              - "Amount Paid"
              - "Is Laundering"
          # Verifies all expected columns exist

        - type: "SchemaMatchCheck"
          severity: "ERROR"
          params:
            expected_schema:
              Timestamp: "string"
              "From Bank": "integer"
              Account: "string"
              "To Bank": "integer"
              "Account.1": "string"
              "Amount Received": "float"
              "Receiving Currency": "string"
              "Amount Paid": "float"
              "Payment Currency": "string"
              "Payment Format": "string"
              "Is Laundering": "integer"
          # Validates column data types

        # ====================================================================
        # FIELD-LEVEL VALIDATIONS (5 types)
        # ====================================================================

        - type: "MandatoryFieldCheck"
          severity: "ERROR"
          params:
            fields:
              - "Timestamp"
              - "From Bank"
              - "Account"
              - "Amount Paid"
          # Ensures critical fields have no nulls

        - type: "DateFormatCheck"
          severity: "ERROR"
          params:
            column: "Timestamp"
            date_format: "%Y/%m/%d %H:%M"
          # Validates timestamp format

        - type: "RangeCheck"
          severity: "WARNING"
          params:
            field: "Amount Paid"
            min_value: 0.01
            max_value: 100000000.0
          # Validates transaction amounts are reasonable

        - type: "ValidValuesCheck"
          severity: "ERROR"
          params:
            column: "Is Laundering"
            valid_values: [0, 1]
          # Binary fraud flag validation

        - type: "RegexCheck"
          severity: "WARNING"
          params:
            column: "Account"
            pattern: "^[0-9A-F]{9}$"
            description: "Account ID format: 9 hex characters"
          # Validates account ID format

        # ====================================================================
        # RECORD-LEVEL VALIDATIONS (3 types)
        # ====================================================================

        - type: "UniqueKeyCheck"
          severity: "WARNING"
          params:
            column: "Account"
          # Checks for unique account identifiers (may have duplicates)

        - type: "DuplicateRowCheck"
          severity: "WARNING"
          params:
            key_columns:
              - "Timestamp"
              - "Account"
              - "Amount Paid"
          # Detects potential duplicate transactions

        - type: "BlankRecordCheck"
          severity: "WARNING"
          # Identifies rows where ALL fields are null (data ingestion errors)
          # OPTIMIZED: Uses vectorized Polars for 100x faster performance

        # ====================================================================
        # ADVANCED VALIDATIONS (9 types)
        # ====================================================================

        - type: "StringLengthCheck"
          severity: "WARNING"
          params:
            field: "Timestamp"
            min_length: 16
            max_length: 16
          # Timestamp fixed length validation

        - type: "CompletenessCheck"
          severity: "WARNING"
          params:
            column: "Payment Format"
            min_completeness: 95.0
          # Ensures >95% data completeness

        - type: "CrossFieldComparisonCheck"
          severity: "ERROR"
          params:
            field1: "Amount Received"
            field2: "Amount Paid"
            operation: "approximately_equal"
            tolerance: 0.01
          # Validates amounts match (accounting for FX)

        - type: "NumericPrecisionCheck"
          severity: "WARNING"
          params:
            field: "Amount Paid"
            max_decimal_places: 2
          # Money should have max 2 decimal places

        - type: "StatisticalOutlierCheck"
          severity: "WARNING"
          params:
            field: "Amount Paid"
            method: "iqr"
            threshold: 3.0
          # Detects unusual transaction amounts

        - type: "FreshnessCheck"
          severity: "WARNING"
          params:
            date_column: "Timestamp"
            max_age_days: 1095  # 3 years
            date_format: "%Y/%m/%d %H:%M"
          # Ensures data is recent (within 3 years)

        - type: "InlineBusinessRuleCheck"
          severity: "ERROR"
          params:
            rule_name: "Valid Currency Codes"
            rule_logic: "lambda row: row['Payment Currency'] in ['US Dollar', 'Euro', 'British Pound', 'Japanese Yen']"
            error_message: "Invalid currency code detected"
          # Business rule: only specific currencies allowed

        - type: "InlineRegexCheck"
          severity: "WARNING"
          params:
            column: "Payment Format"
            pattern: "^(Cheque|Wire|ACH|Reinvestment|Cash)$"
            case_sensitive: true
          # Validates payment format values

        - type: "InlineLookupCheck"
          severity: "WARNING"
          params:
            field: "Receiving Currency"
            lookup_values:
              - "US Dollar"
              - "Euro"
              - "British Pound"
              - "Japanese Yen"
              - "Swiss Franc"
            allow_null: false
          # Reference data validation for currencies

        # ====================================================================
        # STATISTICAL VALIDATIONS (3 types)
        # ====================================================================

        - type: "DistributionCheck"
          severity: "WARNING"
          params:
            field: "Amount Paid"
            expected_distribution: "normal"
            significance_level: 0.05
          # Tests if amounts follow expected distribution

        - type: "CorrelationCheck"
          severity: "WARNING"
          params:
            field1: "Amount Paid"
            field2: "Amount Received"
            min_correlation: 0.8
            max_correlation: 1.0
          # Validates amounts are highly correlated

        - type: "AdvancedAnomalyDetectionCheck"
          severity: "WARNING"
          params:
            columns:
              - "Amount Paid"
              - "From Bank"
              - "To Bank"
            method: "isolation_forest"
            contamination: 0.01
          # ML-based anomaly detection for fraud

        # ====================================================================
        # CONDITIONAL VALIDATION (1 type)
        # ====================================================================

        - type: "ConditionalValidation"
          severity: "WARNING"
          params:
            condition:
              field: "Is Laundering"
              operator: "=="
              value: 1
            then_validations:
              - type: "RangeCheck"
                params:
                  field: "Amount Paid"
                  min_value: 10000.0
                  max_value: 100000000.0
                description: "Laundering transactions should be large amounts"
          # Conditional: if fraud, amount should be significant

        # ====================================================================
        # CROSS-FILE KEY CHECK (NEW!)
        # ====================================================================

        - type: "CrossFileKeyCheck"
          severity: "WARNING"
          params:
            foreign_key: "Account"
            reference_file: "/home/daniel/www/test-data/LI-Large_Trans.parquet"
            reference_key: "Account"
            reference_file_format: "parquet"
            check_mode: "overlap"
            min_overlap_pct: 10.0
          # Validates account overlap between HI and LI datasets
          # Expect some overlap as accounts may appear in both datasets

    # ========================================================================
    # SECONDARY FILE: Low Illicit Activity Transactions (for Cross-File)
    # ========================================================================
    - name: "LI_Transactions"
      path: "/home/daniel/www/test-data/LI-Large_Trans.parquet"
      format: "parquet"

      validations:
        # Basic validations only - this file is primarily for cross-file checks
        - type: "EmptyFileCheck"
          severity: "ERROR"

        - type: "MandatoryFieldCheck"
          severity: "ERROR"
          params:
            fields:
              - "Timestamp"
              - "Account"

        # ====================================================================
        # CROSS-FILE KEY CHECK - Reverse Direction (NEW!)
        # ====================================================================

        - type: "CrossFileKeyCheck"
          severity: "WARNING"
          params:
            foreign_key: "Account"
            reference_file: "/home/daniel/www/test-data/HI-Large_Trans.parquet"
            reference_key: "Account"
            reference_file_format: "parquet"
            check_mode: "subset"
          # Validates all LI accounts exist in HI dataset (subset check)

    # ========================================================================
    # NOTE: Temporal and additional cross-file validations removed
    # ========================================================================
    # The following validation types are not yet implemented:
    #   - CrossFileConsistencyCheck
    #   - CrossFileAggregationCheck
    #   - TemporalDriftCheck
    #   - DataEvolutionCheck
    # These will be added in future releases.

  # ==========================================================================
  # Processing Settings - Optimized for 357M Rows, 10.1GB
  # ==========================================================================

  processing:
    chunk_size: 200000          # Large chunks for Polars efficiency
    max_sample_failures: 1000   # Capture more failures for 357M rows
    parallel_files: false       # Process sequentially for predictable resource usage

  # ==========================================================================
  # Output Configuration
  # ==========================================================================

  output:
    html_report: "ultimate_comprehensive_demo_report.html"
    json_summary: "ultimate_comprehensive_demo_summary.json"
    fail_on_error: false
    fail_on_warning: false
